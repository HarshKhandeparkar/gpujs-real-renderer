!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).GPUjsRealRenderer=e()}(this,(function(){"use strict";var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function e(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function s(t,e,s){return t(s={path:e,exports:{},require:function(t,e){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==e&&s.path)}},s.exports),s.exports}var r=s((function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.getDisplayKernel=void 0,e.getDisplayKernel=function(t,e){return t.createKernel((function(t){var e=t[this.thread.y][this.thread.x];this.color(e[0],e[1],e[2])}),{output:e,graphical:!0})}})),o=s((function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.getBlankGraphKernel=void 0,e.getBlankGraphKernel=function(t,e,s,r,o,i,n){return t.createKernel((function(){var t=this.output.x,e=this.output.y,s=Math.floor(e*(this.constants.xOffset/100)),r=Math.floor(t*(this.constants.yOffset/100));return this.thread.x!==r&&this.thread.y!==s||!this.constants.drawAxes?this.constants.bgColor:this.constants.axesColor}),{output:e,pipeline:!0,constants:{xOffset:s,yOffset:r,bgColor:o,axesColor:i,drawAxes:n},constantTypes:{bgColor:"Array(3)",axesColor:"Array(3)",xOffset:"Float",yOffset:"Float",drawAxes:"Boolean"}})}})),i=s((function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.getCloneTextureKernel=void 0,e.getCloneTextureKernel=function(t,e){return t.createKernel((function(t){return t[this.thread.y][this.thread.x]}),{output:e,pipeline:!0})}})),n=s((function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.getLoadDataKernel=void 0,e.getLoadDataKernel=function(t,e){return t.createKernel((function(t){return[t[this.thread.y*this.output.x*3+3*this.thread.x+0],t[this.thread.y*this.output.x*3+3*this.thread.x+1],t[this.thread.y*this.output.x*3+3*this.thread.x+2]]}),{argumentTypes:{graphPixels:"Array"},output:e,pipeline:!0})}})),a=s((function(t,e){Object.defineProperty(e,"__esModule",{value:!0})})),h=s((function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.RealRendererDefaults=void 0,e.RealRendererDefaults={dimensions:[1e3,1e3],xScaleFactor:10,yScaleFactor:1,bgColor:[0,0,0],drawAxes:!0,axesColor:[1,1,1],drawsPerFrame:1,timeStep:1/60,initTime:0,xOffset:50,yOffset:50,GPU:window.GPU}})),l=s((function(e,s){var l=t&&t.__assign||function(){return(l=Object.assign||function(t){for(var e,s=1,r=arguments.length;s<r;s++)for(var o in e=arguments[s])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},c=t&&t.__createBinding||(Object.create?function(t,e,s,r){void 0===r&&(r=s),Object.defineProperty(t,r,{enumerable:!0,get:function(){return e[s]}})}:function(t,e,s,r){void 0===r&&(r=s),t[r]=e[s]}),u=t&&t.__exportStar||function(t,e){for(var s in t)"default"===s||Object.prototype.hasOwnProperty.call(e,s)||c(e,t,s)};Object.defineProperty(s,"__esModule",{value:!0}),s.RealRenderer=s.RealRendererTypes=void 0,s.RealRendererTypes=a,u(h,s);var p=function(){function t(t){if(t=l(l({},h.RealRendererDefaults),t),this.canvas=this._canvas=t.canvas,this.dimensions=t.dimensions,this.xScaleFactor=t.xScaleFactor,this.yScaleFactor=t.yScaleFactor,this.bgColor=t.bgColor,this.drawAxes=t.drawAxes,this.axesColor=t.axesColor,this.drawsPerFrame=t.drawsPerFrame,this.timeStep=t.timeStep,this.time=t.initTime,this.xOffset=t.xOffset,this.yOffset=t.yOffset,t.GPU=t.GPU,this.xOffset=Math.max(0,Math.min(100,this.xOffset)),this.yOffset=Math.max(0,Math.min(100,this.yOffset)),void 0===this.canvas)throw"No Canvas Element Found";this.gpu=new t.GPU({canvas:this._canvas,mode:"gpu"}),this._blankGraph=o.getBlankGraphKernel(this.gpu,this.dimensions,this.xOffset,this.yOffset,this.bgColor,this.axesColor,this.drawAxes),this._cloneTexture=i.getCloneTextureKernel(this.gpu,this.dimensions),this.graphPixels=this._blankGraph(),this._loadData=n.getLoadDataKernel(this.gpu,this.dimensions),this._display=r.getDisplayKernel(this.gpu,this.dimensions),this._doRender=!1}return t.prototype._drawFunc=function(t,e){return t},t.prototype._overlayFunc=function(t){return t},t.prototype._draw=function(){return this.time+=this.timeStep,this.graphPixels=this._drawFunc(this.graphPixels,this.time),this.graphPixels},t.prototype.draw=function(t){void 0===t&&(t=1);for(var e=0;e<t;e++)this._draw();return this._display(this._overlayFunc(this.graphPixels)),this},t.prototype._render=function(){var t=this;this._doRender&&(this.draw(this.drawsPerFrame),window.requestAnimationFrame((function(){t._render()})))},t.prototype.startRender=function(){if(!this._doRender)return this._doRender=!0,this._render(),this},t.prototype.stopRender=function(){return this._doRender=!1,this},t.prototype.toggleRender=function(){return this._doRender=!this._doRender,this._doRender&&this._render(),this},t.prototype.resetTime=function(){return this.time=0,this},t.prototype.getData=function(){for(var t=this.graphPixels.toArray(),e=[],s=0;s<t.length;s++)for(var r=0;r<t[0].length;r++)for(var o=0;o<t[0][0].length;o++)e[s*t[0].length*t[0][0].length+r*t[0][0].length+o]=t[s][r][o];return e},t.prototype.loadData=function(t){this.graphPixels=this._loadData(t),this._display(this.graphPixels)},t.prototype.reset=function(){return this.graphPixels=this._blankGraph(),this.resetTime(),this._display(this.graphPixels),this},t}();s.RealRenderer=p})),c=s((function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.getProgressGraphKernel=void 0,e.getProgressGraphKernel=function(t,e,s,r,o,i,n){return t.createKernel((function(t,e){var s=this.output.x,r=this.output.y;if(this.thread.x*Math.abs(this.constants.progressiveAxis-1)>=s-e||this.thread.y*this.constants.progressiveAxis>=r+e){var o=Math.floor(r*(this.constants.xOffset/100)),i=Math.floor(s*(this.constants.yOffset/100));return this.thread.x===i||this.thread.y===o?this.constants.axesColor:this.constants.bgColor}return t[this.thread.y+e*this.constants.progressiveAxis][this.thread.x+e*Math.abs(this.constants.progressiveAxis-1)]}),{output:e,pipeline:!0,constants:{progressiveAxis:"y"==s?1:0,xOffset:r,yOffset:o,axesColor:i,bgColor:n},constantTypes:{progressiveAxis:"Integer",xOffset:"Float",yOffset:"Float",axesColor:"Array(3)",bgColor:"Array(3)"}})}})),u=s((function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.getSqueezeGraphKernel=void 0,e.getSqueezeGraphKernel=function(t,e,s,r,o,i,n){return t.createKernel((function(t,e){var s=this.output.x,r=this.output.y,o=Math.floor(r*(this.constants.xOffset/100)),i=Math.floor(s*(this.constants.yOffset/100));if(Math.floor(this.thread.x*(1-this.constants.progressiveAxis)/e)>=s||Math.floor(this.thread.y*this.constants.progressiveAxis/e)>=r)return this.thread.x===i||this.thread.y===o?this.constants.axesColor:this.constants.bgColor;var n=1==this.constants.progressiveAxis?Math.floor(this.thread.y/e):Math.floor(this.thread.y),a=0==this.constants.progressiveAxis?Math.floor(this.thread.x/e):Math.floor(this.thread.x);return t[n][a]}),{output:e,pipeline:!0,constants:{progressiveAxis:"y"==s?1:0,xOffset:r,yOffset:o,axesColor:i,bgColor:n},constantTypes:{progressiveAxis:"Integer",xOffset:"Float",yOffset:"Float",axesColor:"Array(3)",bgColor:"Array(3)"}})}})),p=s((function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.getAddDataKernel=void 0,e.getAddDataKernel=function(t,e,s,r,o,i,n,a,h){return t.createKernel((function(t,e,s,r,o,i,n){var a=this.thread.x+o*Math.abs(this.constants.progressiveAxis-1),h=this.thread.y+o*this.constants.progressiveAxis,l=e[0],c=r[0],u=this.output.x,p=this.output.y,d=a/i-u*(this.constants.yOffset/100)/i,f=h/n-p*(this.constants.xOffset/100)/n,_=(d-s)*i,v=(f-l)*n,y=Math.sqrt(_*_+v*v),x=d*(l-c)-f-s*(l-c)+l,g=Math.abs(x)/Math.sqrt((l-c)*(l-c)+1);return y<=this.constants.brushSize?this.constants.brushColor:g<=this.constants.lineThickness&&d<=s&&d>=s-1&&f<=Math.max(l,c)&&f>=Math.min(l,c)?this.constants.lineColor:t[this.thread.y][this.thread.x]}),{output:e,pipeline:!0,constants:{brushSize:s,brushColor:r,lineThickness:n,lineColor:a,xOffset:o,yOffset:i,progressiveAxis:"y"==h?1:0},constantTypes:{brushColor:"Array(3)",brushSize:"Float",lineThickness:"Float",lineColor:"Array(3)",xOffset:"Float",yOffset:"Float",progressiveAxis:"Integer"}})}})),d=s((function(t,e){Object.defineProperty(e,"__esModule",{value:!0})})),f=s((function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.RealLineGraphDefaults=void 0,e.RealLineGraphDefaults={progressiveAxis:"x",progressionMode:"overflow",progressInterval:1,brushSize:1,brushColor:[1,1,1],lineThickness:.05,lineColor:[0,.5,0]}})),_=s((function(e,s){var r,o=t&&t.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=e[s])})(t,e)},function(t,e){function s(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(s.prototype=e.prototype,new s)}),i=t&&t.__assign||function(){return(i=Object.assign||function(t){for(var e,s=1,r=arguments.length;s<r;s++)for(var o in e=arguments[s])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},n=t&&t.__createBinding||(Object.create?function(t,e,s,r){void 0===r&&(r=s),Object.defineProperty(t,r,{enumerable:!0,get:function(){return e[s]}})}:function(t,e,s,r){void 0===r&&(r=s),t[r]=e[s]}),h=t&&t.__exportStar||function(t,e){for(var s in t)"default"===s||Object.prototype.hasOwnProperty.call(e,s)||n(e,t,s)};Object.defineProperty(s,"__esModule",{value:!0}),s.RealLineGraph=s.RealLineGraphTypes=s.RealRendererTypes=void 0,s.RealRendererTypes=a,s.RealLineGraphTypes=d,h(f,s);var _=function(t){function e(e){var s=t.call(this,e)||this;return e=i(i({},f.RealLineGraphDefaults),e),s.options=e,s.progressiveAxis=e.progressiveAxis,s.progressionMode=e.progressionMode,s.progressInterval=e.progressInterval,s.brushSize=e.brushSize,s.brushColor=e.brushColor,s.lineThickness=e.lineThickness,s.lineColor=e.lineColor,s._progressGraph=c.getProgressGraphKernel(s.gpu,s.dimensions,s.progressiveAxis,s.xOffset,s.yOffset,s.axesColor,s.bgColor),s._squeezeGraph=u.getSqueezeGraphKernel(s.gpu,s.dimensions,s.progressiveAxis,s.xOffset,s.yOffset,s.axesColor,s.bgColor),s._lastProgress=0,s._numProgress=0,s._dataIndex=1,s._lastData=[0],s._addData=p.getAddDataKernel(s.gpu,s.dimensions,s.brushSize,s.brushColor,s.xOffset,s.yOffset,s.lineThickness,s.lineColor,s.progressiveAxis),s.limits={x:[0-s.yOffset/100*(s.dimensions[0]/s.xScaleFactor),s.dimensions[0]/s.xScaleFactor-s.yOffset/100*(s.dimensions[0]/s.xScaleFactor)],y:[0-s.xOffset/100*(s.dimensions[1]/s.yScaleFactor),s.dimensions[1]/s.yScaleFactor-s.xOffset/100*(s.dimensions[1]/s.yScaleFactor)]},s}return o(e,t),e.prototype.addData=function(t){if(isNaN(Number(t))||(t=[Number(t)]),this.graphPixels=this._addData(this._cloneTexture(this.graphPixels),t,this._dataIndex++,this._lastData,this._numProgress,this.xScaleFactor,this.yScaleFactor),this._lastData=t,this._dataIndex>=this.limits.x[1]&&"overflow"==this.progressionMode){var e=Math.ceil("y"==this.progressiveAxis?this.yScaleFactor:this.xScaleFactor);this.graphPixels=this._progressGraph(this._cloneTexture(this.graphPixels),e),this._numProgress+=e,"y"==this.progressiveAxis?(this.limits.y[0]+=e/this.yScaleFactor,this.limits.y[1]+=e/this.yScaleFactor):(this.limits.x[1]+=e/this.xScaleFactor,this.limits.x[0]+=e/this.xScaleFactor)}if(this._dataIndex>=this.limits.x[1]&&"squeeze"==this.progressionMode){var s=this._dataIndex/(this._dataIndex+1);this.graphPixels=this._squeezeGraph(this._cloneTexture(this.graphPixels),s),"x"==this.progressiveAxis?(this.xScaleFactor*=s,this.limits.x[1]/=s):(this.yScaleFactor*=s,this.limits.y[1]/=s)}return this._display(this.graphPixels),this},e.prototype._drawFunc=function(t,e){return"continous"==this.progressionMode&&e-this._lastProgress>=this.progressInterval?(this._lastProgress=e,this._numProgress++,"y"==this.progressiveAxis?(this.limits.y[0]+=1/this.yScaleFactor,this.limits.y[1]+=1/this.yScaleFactor):(this.limits.x[0]+=1/this.xScaleFactor,this.limits.x[1]+=1/this.xScaleFactor),this._progressGraph(this._cloneTexture(t),1)):t},e.prototype.getLimits=function(){return this.limits},e.prototype.reset=function(){return t.prototype.reset.call(this),this._dataIndex=1,this._lastData=[0],this._lastProgress=0,this._numProgress=0,this.xScaleFactor=this.options.xScaleFactor,this.yScaleFactor=this.options.yScaleFactor,this.limits={x:[0-this.yOffset/100*(this.dimensions[0]/this.xScaleFactor),this.dimensions[0]/this.xScaleFactor-this.yOffset/100*(this.dimensions[0]/this.xScaleFactor)],y:[0-this.xOffset/100*(this.dimensions[1]/this.yScaleFactor),this.dimensions[1]/this.yScaleFactor-this.xOffset/100*(this.dimensions[1]/this.yScaleFactor)]},this},e}(l.RealRenderer);s.RealLineGraph=_})),v=s((function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.getPlotKernel=void 0,e.getPlotKernel=function(t,e,s,r,o,i){return t.createKernel((function(t,e,s,r,o){var i=this.thread.x,n=this.thread.y,a=this.output.x,h=this.output.y,l=e*this.constants.xScaleFactor+a*(this.constants.yOffset/100),c=s*this.constants.yScaleFactor+h*(this.constants.xOffset/100),u=i-l,p=n-c,d=Math.sqrt(u*u+p*p),f=t[this.thread.y][this.thread.x];if(d<=r+1){for(var _=0,v=i-1;v<=i+1;v++)for(var y=n-1;y<=n+1;y++){var x=v-l,g=y-c,m=Math.sqrt(Math.pow(x,2)+Math.pow(g,2));_+=1/9*Math.min(1,Math.floor(r/m))}return[o[0]*_+f[0]*(1-_),o[1]*_+f[1]*(1-_),o[2]*_+f[2]*(1-_)]}return f}),{output:e,pipeline:!0,constants:{xScaleFactor:s,yScaleFactor:r,xOffset:o,yOffset:i},constantTypes:{xScaleFactor:"Float",yScaleFactor:"Float",xOffset:"Float",yOffset:"Float"}})}})),y=s((function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.getInterpolateKernel=void 0,e.getInterpolateKernel=function(t,e,s,r,o,i){return t.createKernel("function(\n      graphPixels,\n      val1,\n      val2,\n      lineThickness,\n      lineColor\n    ) {\n      const x = this.thread.x,\n        y = this.thread.y;\n\n      const outX = this.output.x, outY = this.output.y;\n\n      const x1 = (val1[0] * this.constants.xScaleFactor) + outX * (this.constants.yOffset / 100);\n      const y1 = (val1[1] * this.constants.yScaleFactor) + outY * (this.constants.xOffset / 100);\n\n      const x2 = (val2[0] * this.constants.xScaleFactor) + outX * (this.constants.yOffset / 100);\n      const y2 = (val2[1] * this.constants.yScaleFactor) + outY * (this.constants.xOffset / 100);\n\n      let lineEqn = x * (y1 - y2) - x1 * (y1 - y2) - y * (x1 - x2) + y1 * (x1 - x2);\n      let lineDist = Math.abs(lineEqn) / Math.sqrt((y1 - y2) * (y1 - y2) + (x1 - x2) * (x1 - x2));\n\n      const lineSine = Math.abs(\n        (y2 - y1) /\n        Math.sqrt((x1 - x2) ** 2 + (y1 - y2) ** 2)\n      )\n\n      const lineCosine = Math.abs(\n        (x2 - x1) /\n        Math.sqrt((x1 - x2) ** 2 + (y1 - y2) ** 2)\n      )\n\n      const graphColor = graphPixels[this.thread.y][this.thread.x];\n\n      if (\n        (\n          lineDist <= lineThickness + 1 &&\n          x <= Math.max(x1, x2) + (lineThickness + 1) * lineSine &&\n          x >= Math.min(x1, x2) - (lineThickness + 1) * lineSine &&\n          y <= Math.max(y1, y2) + (lineThickness + 1) * lineCosine &&\n          y >= Math.min(y1, y2) - (lineThickness + 1) * lineCosine\n        )\n      ) {\n        let intensity = 0;\n\n        // The following code basically blurs the line by convolving a simple average kernel\n        // Very crude implementation of https://developer.nvidia.com/gpugems/gpugems2/part-iii-high-quality-rendering/chapter-22-fast-prefiltered-lines\n        for (let i = x - 1; i <= x + 1; i++) {\n          for (let j = y - 1; j <= y + 1; j++) {\n            let lineEqn = i * (y1 - y2) - x1 * (y1 - y2) - j * (x1 - x2) + y1 * (x1 - x2);\n            let lineDist = Math.abs(lineEqn) / Math.sqrt((y1 - y2) * (y1 - y2) + (x1 - x2) * (x1 - x2));\n\n            intensity += (1 / 9) * Math.min(\n              1,\n              Math.floor(lineThickness / lineDist)\n            )\n          }\n        }\n\n        return [\n          lineColor[0] * intensity + graphColor[0] * (1 - intensity),\n          lineColor[1] * intensity + graphColor[1] * (1 - intensity),\n          lineColor[2] * intensity + graphColor[2] * (1 - intensity)\n        ]\n      }\n      else return graphColor;\n    }",{output:e,pipeline:!0,constants:{xScaleFactor:s,yScaleFactor:r,xOffset:o,yOffset:i},constantTypes:{xScaleFactor:"Float",yScaleFactor:"Float",xOffset:"Float",yOffset:"Float"}})}})),x=s((function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.convertCartesianPolar=e.convertPolarCartesian=void 0,e.convertPolarCartesian=function(t,e){return[t*Math.cos(e),t*Math.sin(e)]},e.convertCartesianPolar=function(t,e){return[Math.sqrt(t*t+e*e),Math.atan2(e,t)]}})),g=s((function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.Complex=void 0;var s=function(){function t(t,e){return this.r=t,this.theta=e,this.x=x.convertPolarCartesian(this.r,this.theta)[0],this.y=x.convertPolarCartesian(this.r,this.theta)[1],this}return t.prototype.getCartesianForm=function(){return[this.x,this.y]},t.prototype.getPolarForm=function(){return[this.r,this.theta]},t.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this.r=x.convertCartesianPolar(this.x,this.y)[0],this.theta=x.convertCartesianPolar(this.x,this.y)[1],this},t.prototype.subtract=function(t){return this.x-=t.x,this.y-=t.y,this.r=x.convertCartesianPolar(this.x,this.y)[0],this.theta=x.convertCartesianPolar(this.x,this.y)[1],this},t.prototype.multiply=function(t){return this.r*=t.r,this.theta+=t.theta,this.x=x.convertPolarCartesian(this.r,this.theta)[0],this.y=x.convertPolarCartesian(this.r,this.theta)[1],this},t.prototype.divide=function(t){return this.r/=t.r,this.theta-=t.theta,this.x=x.convertPolarCartesian(this.r,this.theta)[0],this.y=x.convertPolarCartesian(this.r,this.theta)[1],this},t.prototype.conjugate=function(){return this.theta*=-1,this.x=x.convertPolarCartesian(this.r,this.theta)[0],this.y=x.convertPolarCartesian(this.r,this.theta)[1],this},t.prototype.reciprocal=function(){return this.r=1/this.r,this.theta*=-1,this.x=x.convertPolarCartesian(this.r,this.theta)[0],this.y=x.convertPolarCartesian(this.r,this.theta)[1],this},t.convertCartesianPolar=x.convertCartesianPolar,t.convertPolarCartesian=x.convertPolarCartesian,t}();e.Complex=s})),m=s((function(t,e){Object.defineProperty(e,"__esModule",{value:!0})})),S=s((function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.RealComplexSpaceDefaults=void 0,e.RealComplexSpaceDefaults={brushSize:1,brushColor:[1,1,1],changeNumbers:function(t,e,s){return t},lineThickness:.5,lineColor:[1,1,1]}})),b=s((function(e,s){var r,o=t&&t.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=e[s])})(t,e)},function(t,e){function s(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(s.prototype=e.prototype,new s)}),i=t&&t.__assign||function(){return(i=Object.assign||function(t){for(var e,s=1,r=arguments.length;s<r;s++)for(var o in e=arguments[s])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},n=t&&t.__createBinding||(Object.create?function(t,e,s,r){void 0===r&&(r=s),Object.defineProperty(t,r,{enumerable:!0,get:function(){return e[s]}})}:function(t,e,s,r){void 0===r&&(r=s),t[r]=e[s]}),h=t&&t.__exportStar||function(t,e){for(var s in t)"default"===s||Object.prototype.hasOwnProperty.call(e,s)||n(e,t,s)};Object.defineProperty(s,"__esModule",{value:!0}),s.RealComplexSpace=s.RealComplexSpaceTypes=s.RealRendererTypes=void 0,s.RealRendererTypes=a,s.RealComplexSpaceTypes=m,h(S,s);var c=function(t){function e(e){var s=t.call(this,e)||this;return s.Complex=g.Complex,e=i(i({},S.RealComplexSpaceDefaults),e),s.brushSize=e.brushSize||1,s.brushColor=e.brushColor||[1,1,1],s.changeNumbers=e.changeNumbers||function(t,e,s){return t},s.lineThickness=e.lineThickness||.5,s.lineColor=e.lineColor||[1,1,1],s.watchedNumbers=[],s._plotComplex=v.getPlotKernel(s.gpu,s.dimensions,s.xScaleFactor,s.yScaleFactor,s.xOffset,s.yOffset),s._plotComplexPersistent=v.getPlotKernel(s.gpu,s.dimensions,s.xScaleFactor,s.yScaleFactor,s.xOffset,s.yOffset),s._interpolateKernel=y.getInterpolateKernel(s.gpu,s.dimensions,s.xScaleFactor,s.yScaleFactor,s.xOffset,s.yOffset),s}return o(e,t),e.prototype.watch=function(t,e,s,r,o,i,n){return void 0===s&&(s=!0),void 0===r&&(r=!0),void 0===o&&(o=!1),void 0===i&&(i=null),void 0===n&&(n={}),this.watchedNumbers.push({name:t,number:e,show:s,persistent:r,interpolate:o,interpolateTo:i,attributes:n}),this},e.prototype.clearWatched=function(){return this.watchedNumbers=[],this},e.prototype._interpolate=function(t,e,s){return t=this._interpolateKernel(this._cloneTexture(t),[e.x,e.y],[s.x,s.y],this.lineThickness,this.lineColor)},e.prototype._overlayFunc=function(t){for(var e in this.watchedNumbers)!this.watchedNumbers[e].persistent&&this.watchedNumbers[e].show&&(t=this._plot(t,this.watchedNumbers[e].number)),this.watchedNumbers[e].interpolate&&(t=this._interpolate(t,this.watchedNumbers[e].number,this.watchedNumbers[e].interpolateTo));return t},e.prototype._drawFunc=function(t,e){for(var s in this.watchedNumbers=this.changeNumbers(this.watchedNumbers,e,this.timeStep),this.watchedNumbers)this.watchedNumbers[s].persistent&&this.watchedNumbers[s].show&&(t=this._plotPersistent(t,this.watchedNumbers[s].number));return t},e.prototype._plot=function(t,e){return this._plotComplex(this._cloneTexture(t),e.x,e.y,this.brushSize,this.brushColor)},e.prototype._plotPersistent=function(t,e){return this._plotComplexPersistent(this._cloneTexture(t),e.x,e.y,this.brushSize,this.brushColor)},e.prototype.plot=function(t){return this._persistentGraphPixels=this._plotPersistent(this._persistentGraphPixels,t),this.graphPixels=this._cloneTexture(this._persistentGraphPixels),this._display(this.graphPixels),this},e}(l.RealRenderer);s.RealComplexSpace=c})),C=s((function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.RealDrawBoardDefaults=void 0,e.RealDrawBoardDefaults={brushSize:1,eraserSize:2,brushColor:[1,1,1],allowUndo:!1,maxUndos:10,tool:"brush"}})),O=s((function(t,e){Object.defineProperty(e,"__esModule",{value:!0})})),P=s((function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e._initializeKernels=void 0,e._initializeKernels=function(){this._plotKernel=v.getPlotKernel(this.gpu,this.dimensions,this.xScaleFactor,this.yScaleFactor,this.xOffset,this.yOffset),this._previewPlot=v.getPlotKernel(this.gpu,this.dimensions,this.xScaleFactor,this.yScaleFactor,this.xOffset,this.yOffset),this._strokeKernel=y.getInterpolateKernel(this.gpu,this.dimensions,this.xScaleFactor,this.yScaleFactor,this.xOffset,this.yOffset)}})),M=s((function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e._stroke=e._plot=void 0,e._plot=function(t,e,s,r){return this.graphPixels=this._plotKernel(this._cloneTexture(this.graphPixels),t,e,s,r),this},e._stroke=function(t,e,s,r,o){this._lastCoords.has(o)||this._lastCoords.set(o,[t,e]),this.graphPixels=this._strokeKernel(this._cloneTexture(this.graphPixels),this._lastCoords.get(o),[t,e],s,r)}})),w=s((function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.redo=e.undo=void 0,e.undo=function(t){if(void 0===t&&(t=1),this._currentSnapshotIndex-t>=0&&this._currentSnapshotIndex-t<this._snapshots.length){var e=this._isDrawing;this.stopRender(),this.graphPixels=this._loadData(this._snapshots[this._currentSnapshotIndex-t]),this._currentSnapshotIndex-=t,this._display(this.graphPixels),e&&this.startRender()}return this},e.redo=function(t){return void 0===t&&(t=1),this.undo(-t),this}})),F=s((function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e._toolPreview=e._doStroke=e._endStroke=e._startStroke=e.name=void 0,e.name="brush",e._startStroke=function(t,e){this._currentSnapshotIndex<this._snapshots.length-1&&this._maxSnapshots>0&&this._snapshots.splice(this._currentSnapshotIndex+1),this._plot(t[0],t[1],this.brushSize,this.brushColor),this._lastCoords.set(e,t)},e._endStroke=function(t,e){this._plot(t[0],t[1],this.brushSize,this.brushColor),this._lastCoords.delete(e),this._maxSnapshots>0&&(this._snapshots[++this._currentSnapshotIndex]=this.getData()),this._snapshots.length>this._maxSnapshots&&(this._snapshots.shift(),this._currentSnapshotIndex--)},e._doStroke=function(t,e){this._plot(t[0],t[1],this.brushSize,this.brushColor),this._stroke(t[0],t[1],this.brushSize,this.brushColor,e),this._lastCoords.set(e,t)},e._toolPreview=function(t,e){return this._previewPlot(this.graphPixels,t[0],t[1],this.brushSize,this.brushColor)}})),R=s((function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e._toolPreview=e._doStroke=e._endStroke=e._startStroke=e.name=void 0,e.name="eraser",e._startStroke=function(t,e){this._currentSnapshotIndex<this._snapshots.length-1&&this._maxSnapshots>0&&this._snapshots.splice(this._currentSnapshotIndex+1),this._plot(t[0],t[1],this.eraserSize,this.bgColor),this._lastCoords.set(e,t)},e._endStroke=function(t,e){this._plot(t[0],t[1],this.eraserSize,this.bgColor),this._lastCoords.delete(e),this._maxSnapshots>0&&(this._snapshots[++this._currentSnapshotIndex]=this.getData()),this._snapshots.length>this._maxSnapshots&&(this._snapshots.shift(),this._currentSnapshotIndex--)},e._doStroke=function(t,e){this._plot(t[0],t[1],this.eraserSize,this.bgColor),this._stroke(t[0],t[1],this.eraserSize,this.bgColor,e),this._lastCoords.set(e,t)},e._toolPreview=function(t,e){return this._previewPlot(this.graphPixels,t[0],t[1],this.eraserSize,this.bgColor)}})),D=s((function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e._toolPreview=e._doStroke=e._endStroke=e._startStroke=e.name=void 0,e.name="line";var s=new Map;e._startStroke=function(t,e){this._currentSnapshotIndex<this._snapshots.length-1&&this._maxSnapshots>0&&this._snapshots.splice(this._currentSnapshotIndex+1),this._plot(t[0],t[1],this.brushSize,this.brushColor),this._lastCoords.set(e,t),s.set(e,t)},e._endStroke=function(t,e){this.graphPixels=this._strokeKernel(this._cloneTexture(this.graphPixels),s.get(e),t,this.brushSize,this.brushColor),this._plot(t[0],t[1],this.brushSize,this.brushColor),this._lastCoords.delete(e),s.delete(e)},e._doStroke=function(t,e){this._lastCoords.set(e,t)},e._toolPreview=function(t,e){return s.has(e)?this._strokeKernel(this._cloneTexture(this.graphPixels),s.get(e),t,this.brushSize,this.brushColor):this.graphPixels}})),T=s((function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.tools=void 0,e.tools={brush:F,eraser:R,line:D}})),j=s((function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e._resetBoard=e.clear=e.changeTool=e.changeEraserSize=e.changeBrushSize=e.changeBrushColor=void 0,e.changeBrushColor=function(t){return this.brushColor=t,this},e.changeBrushSize=function(t){return this.brushSize=t,this},e.changeEraserSize=function(t){return this.eraserSize=t,this},e.changeTool=function(t){return this.tool=t,this._startStroke=T.tools[this.tool]._startStroke,this._doStroke=T.tools[this.tool]._doStroke,this._endStroke=T.tools[this.tool]._endStroke,this._toolPreview=T.tools[this.tool]._toolPreview,this},e.clear=function(){return this._snapshots=[],this._currentSnapshotIndex=0,this._lastCoords.clear(),this.graphPixels=this._blankGraph(),this._snapshots[0]=this.getData(),this._display(this.graphPixels),this},e._resetBoard=function(){this.xScaleFactor=this.options.xScaleFactor,this.yScaleFactor=this.options.yScaleFactor,this.brushColor=this.options.brushColor,this.brushSize=this.options.brushSize,this.bgColor=this.options.bgColor,this.eraserSize=this.options.eraserSize,this.tool=this.options.tool,this._isDrawing=!1,this._currentSnapshotIndex=0,this._snapshots=[this.getData()],this._lastCoords.clear(),this.stopRender()}})),k=s((function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e._removeDOMEvents=e._addDOMEvents=void 0,e._addDOMEvents=function(){this.canvas.addEventListener("mousedown",this._mouseDownEventListener),this.canvas.addEventListener("mouseup",this._mouseUpEventListener),this.canvas.addEventListener("mouseleave",this._mouseLeaveEventListener),this.canvas.addEventListener("mousemove",this._previewMouseMoveEventListener),this.canvas.addEventListener("touchstart",this._touchStartEventListener),this.canvas.addEventListener("touchmove",this._touchMoveEventListener),this.canvas.addEventListener("touchend",this._touchEndEventListener),this.canvas.addEventListener("touchmove",this._previewTouchMoveEventListener)},e._removeDOMEvents=function(){this.canvas.removeEventListener("mousedown",this._mouseDownEventListener),this.canvas.removeEventListener("mouseup",this._mouseUpEventListener),this.canvas.removeEventListener("mouseexit",this._mouseLeaveEventListener),this.canvas.removeEventListener("mousemove",this._previewMouseMoveEventListener),this.canvas.removeEventListener("touchstart",this._touchStartEventListener),this.canvas.removeEventListener("touchmove",this._touchMoveEventListener),this.canvas.removeEventListener("touchend",this._touchEndEventListener),this.canvas.removeEventListener("touchmove",this._previewTouchMoveEventListener)}})),E=s((function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e._getTouchCoords=e._getMouseCoords=void 0,e._getMouseCoords=function(t){var e=t.offsetX*this.dimensions[0]/this.canvas.getBoundingClientRect().width,s=t.offsetY*this.dimensions[1]/this.canvas.getBoundingClientRect().height,r=e,o=this.dimensions[1]-s;return[r=r/this.xScaleFactor-this.dimensions[0]*(this.yOffset/100)/this.xScaleFactor,o=o/this.yScaleFactor-this.dimensions[1]*(this.xOffset/100)/this.yScaleFactor]},e._getTouchCoords=function(t){var e=(t.clientX-this.canvas.getBoundingClientRect().left)*this.dimensions[0]/this.canvas.getBoundingClientRect().width,s=(t.clientY-this.canvas.getBoundingClientRect().top)*this.dimensions[1]/this.canvas.getBoundingClientRect().height,r=e,o=this.dimensions[1]-s;return[r=r/this.xScaleFactor-this.dimensions[0]*(this.yOffset/100)/this.xScaleFactor,o=o/this.yScaleFactor-this.dimensions[1]*(this.xOffset/100)/this.yScaleFactor]}})),L=s((function(e,s){var r,o=t&&t.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=e[s])})(t,e)},function(t,e){function s(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(s.prototype=e.prototype,new s)}),i=t&&t.__assign||function(){return(i=Object.assign||function(t){for(var e,s=1,r=arguments.length;s<r;s++)for(var o in e=arguments[s])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},n=t&&t.__createBinding||(Object.create?function(t,e,s,r){void 0===r&&(r=s),Object.defineProperty(t,r,{enumerable:!0,get:function(){return e[s]}})}:function(t,e,s,r){void 0===r&&(r=s),t[r]=e[s]}),h=t&&t.__exportStar||function(t,e){for(var s in t)"default"===s||Object.prototype.hasOwnProperty.call(e,s)||n(e,t,s)};Object.defineProperty(s,"__esModule",{value:!0}),s.RealDrawBoard=s.RealDrawBoardTypes=s.RealRendererTypes=void 0,s.RealRendererTypes=a,s.RealDrawBoardTypes=O,h(C,s);var c=function(t){function e(e){var s=t.call(this,e)||this;return s.tool=C.RealDrawBoardDefaults.tool,s._isDrawing=!1,s._snapshots=[],s._currentSnapshotIndex=0,s._lastCoords=new Map,s._initializeKernels=P._initializeKernels,s._stroke=M._stroke,s._plot=M._plot,s._resetBoard=j._resetBoard,s._addDOMEvents=k._addDOMEvents,s._removeDOMEvents=k._removeDOMEvents,s._startStroke=T.tools[C.RealDrawBoardDefaults.tool]._startStroke,s._endStroke=T.tools[C.RealDrawBoardDefaults.tool]._endStroke,s._doStroke=T.tools[C.RealDrawBoardDefaults.tool]._doStroke,s._toolPreview=T.tools[C.RealDrawBoardDefaults.tool]._toolPreview,s._getMouseCoords=E._getMouseCoords,s._getTouchCoords=E._getTouchCoords,s.undo=w.undo,s.redo=w.redo,s.changeBrushColor=j.changeBrushColor,s.changeBrushSize=j.changeBrushSize,s.changeEraserSize=j.changeEraserSize,s.changeTool=j.changeTool,s.clear=j.clear,s._mouseDownEventListener=function(t){0===t.button&&(s.canvas.addEventListener("mousemove",s._mouseMoveEventListener),s._startStroke(s._getMouseCoords(t),"mouse"))},s._mouseUpEventListener=function(t){if(0===t.button){var e=s._getMouseCoords(t);s._lastCoords.has("mouse")&&s._endStroke(e,"mouse"),s.canvas.removeEventListener("mousemove",s._mouseMoveEventListener)}},s._mouseLeaveEventListener=function(t){s.canvas.removeEventListener("mousemove",s._mouseMoveEventListener),s._lastCoords.has("mouse")&&s._endStroke(s._getMouseCoords(t),"mouse")},s._mouseMoveEventListener=function(t){var e=s._getMouseCoords(t);s._doStroke(e,"mouse")},s._previewMouseMoveEventListener=function(t){var e=s._getMouseCoords(t);s._display(s._toolPreview(e,"mouse"))},s._touchStartEventListener=function(t){t.preventDefault();for(var e=0;e<t.touches.length;e++)s._startStroke(s._getTouchCoords(t.touches.item(e)),t.touches.item(e).identifier.toString())},s._touchEndEventListener=function(t){t.preventDefault();for(var e=0;e<t.changedTouches.length;e++)s._endStroke(s._getTouchCoords(t.changedTouches.item(e)),t.changedTouches.item(e).identifier.toString())},s._touchMoveEventListener=function(t){t.preventDefault();for(var e=0;e<t.touches.length;e++)s._display(s._toolPreview(s._getTouchCoords(t.touches.item(e)),t.touches.item(e).identifier.toString()));s._display(s.graphPixels)},s._previewTouchMoveEventListener=function(t){t.preventDefault();for(var e=0;e<t.touches.length;e++)s._doStroke(s._getTouchCoords(t.touches.item(e)),t.touches.item(e).identifier.toString());s._display(s.graphPixels)},e=i(i({},C.RealDrawBoardDefaults),e),s.options=e,s.brushSize=e.brushSize,s.brushColor=e.brushColor,s.eraserSize=e.eraserSize,s._maxSnapshots=e.allowUndo?Math.max(e.maxUndos+1,0):0,s.changeTool(e.tool),s._initializeKernels(),s._snapshots[0]=s.getData(),s}return o(e,t),e.prototype.startRender=function(){return this._addDOMEvents(),this._isDrawing=!0,this},e.prototype.stopRender=function(){return this._removeDOMEvents(),this._isDrawing=!1,this},e.prototype.reset=function(){return this._resetBoard(),t.prototype.reset.call(this),this},e}(l.RealRenderer);s.RealDrawBoard=c}));return e(s((function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.RealDrawBoard=e.RealComplexSpace=e.RealLineGraph=e.RealRenderer=void 0,Object.defineProperty(e,"RealRenderer",{enumerable:!0,get:function(){return l.RealRenderer}}),Object.defineProperty(e,"RealLineGraph",{enumerable:!0,get:function(){return _.RealLineGraph}}),Object.defineProperty(e,"RealComplexSpace",{enumerable:!0,get:function(){return b.RealComplexSpace}}),Object.defineProperty(e,"RealDrawBoard",{enumerable:!0,get:function(){return L.RealDrawBoard}})})))}));
